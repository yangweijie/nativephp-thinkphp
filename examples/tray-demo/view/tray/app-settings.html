<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>应用设置</title>
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>应用设置</h1>
        </div>
        
        <div class="content">
            <div class="card">
                <div class="card-header">
                    <h2>基本设置</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="appName">应用名称</label>
                        <input type="text" id="appName" class="form-control" value="{$settings.name ?? '系统托盘示例'}">
                    </div>
                    
                    <div class="form-group">
                        <label for="appVersion">应用版本</label>
                        <input type="text" id="appVersion" class="form-control" value="{$settings.version ?? '1.0.0'}">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>窗口设置</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="windowWidth">窗口宽度</label>
                        <input type="number" id="windowWidth" class="form-control" value="{$settings.window.width ?? 800}">
                    </div>
                    
                    <div class="form-group">
                        <label for="windowHeight">窗口高度</label>
                        <input type="number" id="windowHeight" class="form-control" value="{$settings.window.height ?? 600}">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="windowResizable" {($settings.window.resizable ?? true) ? 'checked' : ''}> 允许调整窗口大小
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="windowMinimizable" {($settings.window.minimizable ?? true) ? 'checked' : ''}> 允许最小化窗口
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="windowMaximizable" {($settings.window.maximizable ?? true) ? 'checked' : ''}> 允许最大化窗口
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="windowClosable" {($settings.window.closable ?? true) ? 'checked' : ''}> 允许关闭窗口
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>启动设置</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="startMinimized" {($settings.start_minimized ?? false) ? 'checked' : ''}> 启动时最小化到托盘
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="startAtLogin" {($settings.start_at_login ?? false) ? 'checked' : ''}> 开机自动启动
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="minimizeToTray" {($settings.minimize_to_tray ?? true) ? 'checked' : ''}> 最小化到托盘
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="closeToTray" {($settings.close_to_tray ?? true) ? 'checked' : ''}> 关闭到托盘
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="saveAppSettings()">保存设置</button>
                <button class="btn btn-secondary" onclick="closeWindow()">关闭</button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    <script>
        // 保存应用设置
        function saveAppSettings() {
            const settings = {
                name: document.getElementById('appName').value,
                version: document.getElementById('appVersion').value,
                window: {
                    width: parseInt(document.getElementById('windowWidth').value),
                    height: parseInt(document.getElementById('windowHeight').value),
                    resizable: document.getElementById('windowResizable').checked,
                    minimizable: document.getElementById('windowMinimizable').checked,
                    maximizable: document.getElementById('windowMaximizable').checked,
                    closable: document.getElementById('windowClosable').checked,
                },
                start_minimized: document.getElementById('startMinimized').checked,
                start_at_login: document.getElementById('startAtLogin').checked,
                minimize_to_tray: document.getElementById('minimizeToTray').checked,
                close_to_tray: document.getElementById('closeToTray').checked,
            };
            
            fetch('/tray/saveAppSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    settings,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '保存应用设置失败');
            });
        }
        
        // 关闭窗口
        function closeWindow() {
            if (typeof window.NativePHP !== 'undefined') {
                window.NativePHP.window.close();
            } else {
                window.close();
            }
        }
        
        // 显示通知
        function showNotification(title, body) {
            if (typeof window.NativePHP !== 'undefined') {
                window.NativePHP.notification.send(title, body);
            } else {
                alert(`${title}: ${body}`);
            }
        }
    </script>
</body>
</html>

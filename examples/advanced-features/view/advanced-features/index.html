<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>高级功能示例</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #555;
            margin-top: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button.secondary {
            background-color: #2196F3;
        }
        button.secondary:hover {
            background-color: #0b7dda;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #d32f2f;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>高级功能示例</h1>
        
        <div class="section">
            <h2>窗口管理</h2>
            <div class="button-group">
                <button onclick="createTransparentWindow()">创建透明窗口</button>
                <button onclick="createModalWindow()">创建模态窗口</button>
            </div>
        </div>
        
        <div class="section">
            <h2>菜单管理</h2>
            <div class="button-group">
                <button onclick="createApplicationMenu()">创建应用菜单</button>
                <button onclick="createContextMenu()">创建上下文菜单</button>
            </div>
        </div>
        
        <div class="section">
            <h2>文件上传和下载</h2>
            <div class="form-group">
                <label for="file">选择文件上传</label>
                <input type="file" id="file">
                <button onclick="uploadFile()">上传</button>
            </div>
            <div class="form-group">
                <label for="url">下载 URL</label>
                <input type="text" id="url" placeholder="https://example.com/file.txt">
                <button onclick="downloadFile()">下载</button>
            </div>
            <div id="fileResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h2>对话框</h2>
            <div class="button-group">
                <button onclick="showDialog('info')">信息</button>
                <button onclick="showDialog('error')" class="danger">错误</button>
                <button onclick="showDialog('warning')" class="secondary">警告</button>
                <button onclick="showDialog('question')">问题</button>
                <button onclick="showDialog('confirm')">确认</button>
                <button onclick="showDialog('prompt')">输入</button>
                <button onclick="showDialog('openFile')">打开文件</button>
                <button onclick="showDialog('saveFile')">保存文件</button>
                <button onclick="showDialog('selectFolder')">选择文件夹</button>
                <button onclick="showDialog('color')">选择颜色</button>
                <button onclick="showDialog('font')">选择字体</button>
                <button onclick="showDialog('custom')">自定义对话框</button>
            </div>
            <div id="dialogResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h2>事件系统</h2>
            <div class="form-group">
                <label for="eventType">事件类型</label>
                <select id="eventType">
                    <option value="window">窗口事件</option>
                    <option value="menu">菜单事件</option>
                </select>
            </div>
            <div class="form-group">
                <label for="eventName">事件名称</label>
                <input type="text" id="eventName" placeholder="例如: click, close, focus">
            </div>
            <div class="form-group">
                <label for="eventData">事件数据 (JSON)</label>
                <input type="text" id="eventData" placeholder='{"key": "value"}'>
            </div>
            <button onclick="triggerEvent()">触发事件</button>
            <div id="eventResult" class="result" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        // 当前窗口 ID
        let currentWindowId = null;
        
        // 页面加载时获取当前窗口 ID
        window.addEventListener('DOMContentLoaded', function() {
            if (typeof window.NativePHP !== 'undefined') {
                currentWindowId = window.NativePHP.window.id;
            }
        });
        
        // 创建透明窗口
        function createTransparentWindow() {
            fetch('/advanced-features/createTransparentWindow', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', '已创建透明窗口');
                } else {
                    showNotification('错误', data.message || '创建窗口失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建窗口失败');
            });
        }
        
        // 创建模态窗口
        function createModalWindow() {
            fetch('/advanced-features/createModalWindow', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ parentId: currentWindowId }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', '已创建模态窗口');
                } else {
                    showNotification('错误', data.message || '创建窗口失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建窗口失败');
            });
        }
        
        // 创建应用菜单
        function createApplicationMenu() {
            fetch('/advanced-features/createApplicationMenu', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', '已创建应用菜单');
                } else {
                    showNotification('错误', data.message || '创建菜单失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建菜单失败');
            });
        }
        
        // 创建上下文菜单
        function createContextMenu() {
            fetch('/advanced-features/createContextMenu', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', '已创建上下文菜单（右键点击页面）');
                } else {
                    showNotification('错误', data.message || '创建菜单失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建菜单失败');
            });
        }
        
        // 上传文件
        function uploadFile() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('错误', '请选择文件');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('/advanced-features/uploadFile', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('fileResult');
                resultElement.style.display = 'block';
                
                if (data.success) {
                    resultElement.textContent = `上传成功: ${data.filePath}`;
                    showNotification('成功', '文件上传成功');
                } else {
                    resultElement.textContent = `上传失败: ${data.message}`;
                    showNotification('错误', data.message || '文件上传失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('fileResult').textContent = `上传失败: ${error.message}`;
                document.getElementById('fileResult').style.display = 'block';
                showNotification('错误', '文件上传失败');
            });
        }
        
        // 下载文件
        function downloadFile() {
            const url = document.getElementById('url').value;
            
            if (!url) {
                showNotification('错误', '请输入下载 URL');
                return;
            }
            
            fetch('/advanced-features/downloadFile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ url }),
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('fileResult');
                resultElement.style.display = 'block';
                
                if (data.success) {
                    resultElement.textContent = `下载成功: ${data.savePath}`;
                    showNotification('成功', '文件下载成功');
                } else {
                    resultElement.textContent = `下载失败: ${data.message}`;
                    showNotification('错误', data.message || '文件下载失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('fileResult').textContent = `下载失败: ${error.message}`;
                document.getElementById('fileResult').style.display = 'block';
                showNotification('错误', '文件下载失败');
            });
        }
        
        // 显示对话框
        function showDialog(type) {
            fetch('/advanced-features/showDialog', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ type }),
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('dialogResult');
                resultElement.style.display = 'block';
                
                if (data.success) {
                    resultElement.textContent = `对话框结果: ${JSON.stringify(data.result)}`;
                } else {
                    resultElement.textContent = `显示对话框失败: ${data.message}`;
                    showNotification('错误', data.message || '显示对话框失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('dialogResult').textContent = `显示对话框失败: ${error.message}`;
                document.getElementById('dialogResult').style.display = 'block';
                showNotification('错误', '显示对话框失败');
            });
        }
        
        // 触发事件
        function triggerEvent() {
            const type = document.getElementById('eventType').value;
            const eventName = document.getElementById('eventName').value;
            let eventData = document.getElementById('eventData').value;
            
            if (!eventName) {
                showNotification('错误', '请输入事件名称');
                return;
            }
            
            try {
                eventData = eventData ? JSON.parse(eventData) : {};
            } catch (e) {
                showNotification('错误', '事件数据必须是有效的 JSON');
                return;
            }
            
            const requestData = {
                type,
                eventType: eventName,
                data: eventData,
            };
            
            if (type === 'window') {
                requestData.windowId = currentWindowId;
            } else if (type === 'menu') {
                requestData.menuId = 'app-menu';
            }
            
            fetch('/advanced-features/triggerEvent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData),
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('eventResult');
                resultElement.style.display = 'block';
                
                if (data.success) {
                    resultElement.textContent = `事件已触发: ${type}.${eventName}`;
                    showNotification('成功', '事件已触发');
                } else {
                    resultElement.textContent = `触发事件失败: ${data.message}`;
                    showNotification('错误', data.message || '触发事件失败');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('eventResult').textContent = `触发事件失败: ${error.message}`;
                document.getElementById('eventResult').style.display = 'block';
                showNotification('错误', '触发事件失败');
            });
        }
        
        // 显示通知
        function showNotification(title, body) {
            if (typeof window.NativePHP !== 'undefined') {
                window.NativePHP.notification.send(title, body);
            } else {
                alert(`${title}: ${body}`);
            }
        }
    </script>
</body>
</html>

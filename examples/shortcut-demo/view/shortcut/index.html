<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>桌面快捷方式示例</title>
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>桌面快捷方式示例</h1>
        </div>
        
        <div class="content">
            <div class="card">
                <div class="card-header">
                    <h2>应用信息</h2>
                </div>
                <div class="card-body">
                    <div class="info-group">
                        <div class="info-item">
                            <div class="info-label">应用名称</div>
                            <div class="info-value">{$applicationName}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">应用路径</div>
                            <div class="info-value">{$applicationPath}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">桌面路径</div>
                            <div class="info-value">{$desktopPath}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">开始菜单路径</div>
                            <div class="info-value">{$startMenuPath}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>快捷方式状态</h2>
                    <div class="card-actions">
                        <button class="btn btn-secondary" onclick="refreshStatus()">刷新</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="status-group">
                        <div class="status-item">
                            <div class="status-label">桌面快捷方式</div>
                            <div class="status-value">
                                <span class="status-badge {$desktopShortcutExists ? 'status-badge-success' : 'status-badge-danger'}">
                                    {$desktopShortcutExists ? '已创建' : '未创建'}
                                </span>
                            </div>
                            <div class="status-actions">
                                {if $desktopShortcutExists}
                                <button class="btn btn-danger" onclick="removeDesktopShortcut()">删除</button>
                                {else}
                                <button class="btn btn-primary" onclick="createDesktopShortcut()">创建</button>
                                {/if}
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div class="status-label">开始菜单快捷方式</div>
                            <div class="status-value">
                                <span class="status-badge {$startMenuShortcutExists ? 'status-badge-success' : 'status-badge-danger'}">
                                    {$startMenuShortcutExists ? '已创建' : '未创建'}
                                </span>
                            </div>
                            <div class="status-actions">
                                {if $startMenuShortcutExists}
                                <button class="btn btn-danger" onclick="removeStartMenuShortcut()">删除</button>
                                {else}
                                <button class="btn btn-primary" onclick="createStartMenuShortcut()">创建</button>
                                {/if}
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div class="status-label">开机自启动</div>
                            <div class="status-value">
                                <span class="status-badge {$loginItemSettings.openAtLogin ? 'status-badge-success' : 'status-badge-danger'}">
                                    {$loginItemSettings.openAtLogin ? '已启用' : '未启用'}
                                </span>
                            </div>
                            <div class="status-actions">
                                {if $loginItemSettings.openAtLogin}
                                <button class="btn btn-danger" onclick="disableLoginItem()">禁用</button>
                                {else}
                                <button class="btn btn-primary" onclick="enableLoginItem()">启用</button>
                                {/if}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>创建自定义快捷方式</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="customPath">快捷方式路径</label>
                        <input type="text" id="customPath" class="form-control" placeholder="例如：C:\Users\Username\Desktop\MyApp.lnk">
                    </div>
                    
                    <div class="form-group">
                        <label for="customArguments">启动参数</label>
                        <input type="text" id="customArguments" class="form-control" placeholder="例如：--debug">
                    </div>
                    
                    <div class="form-group">
                        <label for="customDescription">描述</label>
                        <input type="text" id="customDescription" class="form-control" placeholder="例如：我的应用程序">
                    </div>
                    
                    <div class="form-group">
                        <label for="customIcon">图标路径</label>
                        <input type="text" id="customIcon" class="form-control" placeholder="例如：C:\Path\To\Icon.ico">
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="createCustomShortcut()">创建</button>
                        <button class="btn btn-danger" onclick="removeCustomShortcut()">删除</button>
                        <button class="btn btn-secondary" onclick="checkCustomShortcut()">检查</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>开机自启动设置</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="openAtLogin" {$loginItemSettings.openAtLogin ? 'checked' : ''}> 开机启动
                            </label>
                            
                            <label>
                                <input type="checkbox" id="openAsHidden" {$loginItemSettings.openAsHidden ? 'checked' : ''}> 隐藏启动
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginItemPath">应用路径</label>
                        <input type="text" id="loginItemPath" class="form-control" value="{$loginItemSettings.path ?? $applicationPath}">
                    </div>
                    
                    <div class="form-group">
                        <label for="loginItemArgs">启动参数</label>
                        <input type="text" id="loginItemArgs" class="form-control" placeholder="例如：--start-minimized">
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="saveLoginItemSettings()">保存设置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化应用
            initApp();
        });
        
        // 初始化应用
        function initApp() {
            // 这里可以添加初始化代码
        }
        
        // 刷新状态
        function refreshStatus() {
            location.reload();
        }
        
        // 创建桌面快捷方式
        function createDesktopShortcut() {
            fetch('/shortcut/createDesktopShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建桌面快捷方式失败');
            });
        }
        
        // 删除桌面快捷方式
        function removeDesktopShortcut() {
            fetch('/shortcut/removeDesktopShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '删除桌面快捷方式失败');
            });
        }
        
        // 创建开始菜单快捷方式
        function createStartMenuShortcut() {
            fetch('/shortcut/createStartMenuShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建开始菜单快捷方式失败');
            });
        }
        
        // 删除开始菜单快捷方式
        function removeStartMenuShortcut() {
            fetch('/shortcut/removeStartMenuShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '删除开始菜单快捷方式失败');
            });
        }
        
        // 创建自定义快捷方式
        function createCustomShortcut() {
            const path = document.getElementById('customPath').value;
            const arguments = document.getElementById('customArguments').value;
            const description = document.getElementById('customDescription').value;
            const icon = document.getElementById('customIcon').value;
            
            if (!path) {
                showNotification('错误', '快捷方式路径不能为空');
                return;
            }
            
            fetch('/shortcut/createCustomShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path,
                    arguments,
                    description,
                    icon,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '创建自定义快捷方式失败');
            });
        }
        
        // 删除自定义快捷方式
        function removeCustomShortcut() {
            const path = document.getElementById('customPath').value;
            
            if (!path) {
                showNotification('错误', '快捷方式路径不能为空');
                return;
            }
            
            fetch('/shortcut/removeCustomShortcut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '删除自定义快捷方式失败');
            });
        }
        
        // 检查自定义快捷方式
        function checkCustomShortcut() {
            const path = document.getElementById('customPath').value;
            
            if (!path) {
                showNotification('错误', '快捷方式路径不能为空');
                return;
            }
            
            fetch('/shortcut/exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    path,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('检查结果', data.exists ? '快捷方式存在' : '快捷方式不存在');
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '检查自定义快捷方式失败');
            });
        }
        
        // 启用开机自启动
        function enableLoginItem() {
            fetch('/shortcut/setLoginItemSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    enabled: true,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '启用开机自启动失败');
            });
        }
        
        // 禁用开机自启动
        function disableLoginItem() {
            fetch('/shortcut/setLoginItemSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    enabled: false,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '禁用开机自启动失败');
            });
        }
        
        // 保存开机自启动设置
        function saveLoginItemSettings() {
            const openAtLogin = document.getElementById('openAtLogin').checked;
            const openAsHidden = document.getElementById('openAsHidden').checked;
            const path = document.getElementById('loginItemPath').value;
            const args = document.getElementById('loginItemArgs').value;
            
            fetch('/shortcut/setLoginItemSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    enabled: openAtLogin,
                    open_as_hidden: openAsHidden,
                    path,
                    args: args ? args.split(' ') : [],
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    refreshStatus();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '保存开机自启动设置失败');
            });
        }
        
        // 显示通知
        function showNotification(title, body) {
            if (typeof window.NativePHP !== 'undefined') {
                window.NativePHP.notification.send(title, body);
            } else {
                alert(`${title}: ${body}`);
            }
        }
    </script>
</body>
</html>

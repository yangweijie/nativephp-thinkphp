<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>事件广播示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .btn {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .btn-secondary {
            background-color: #2196F3;
        }
        .btn-secondary:hover {
            background-color: #0b7dda;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>事件广播示例</h1>
        
        <div class="card">
            <h2>简介</h2>
            <p>这个示例展示了如何使用 NativePHP for ThinkPHP 的事件广播功能在不同窗口和组件之间进行通信。</p>
            <p>你可以打开发送者和接收者窗口，然后在发送者窗口中广播事件，接收者窗口将接收并显示这些事件。</p>
        </div>
        
        <div class="card">
            <h2>窗口管理</h2>
            <p>点击下面的按钮打开发送者和接收者窗口：</p>
            <button class="btn" onclick="openWindow('sender')">打开发送者窗口</button>
            <button class="btn btn-secondary" onclick="openWindow('receiver')">打开接收者窗口</button>
        </div>
        
        <div class="card">
            <h2>频道管理</h2>
            <p>创建和管理广播频道：</p>
            <div>
                <input type="text" id="channelName" placeholder="频道名称">
                <button class="btn" onclick="createChannel()">创建频道</button>
                <button class="btn btn-secondary" onclick="getChannels()">获取频道列表</button>
            </div>
            <div id="channelList" style="margin-top: 10px;"></div>
        </div>
    </div>
    
    <script>
        // 打开窗口
        function openWindow(type) {
            fetch('/broadcasting/openWindow', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ type: type })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log(`${type} 窗口已打开，ID: ${data.windowId}`);
                } else {
                    console.error('打开窗口失败');
                }
            })
            .catch(error => {
                console.error('错误:', error);
            });
        }
        
        // 创建频道
        function createChannel() {
            const channelName = document.getElementById('channelName').value;
            if (!channelName) {
                alert('请输入频道名称');
                return;
            }
            
            fetch('/broadcasting/createChannel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ channel: channelName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`频道 ${channelName} 创建成功`);
                    getChannels();
                } else {
                    alert('创建频道失败');
                }
            })
            .catch(error => {
                console.error('错误:', error);
            });
        }
        
        // 获取频道列表
        function getChannels() {
            fetch('/broadcasting/channels')
            .then(response => response.json())
            .then(data => {
                const channelList = document.getElementById('channelList');
                channelList.innerHTML = '<h3>频道列表：</h3>';
                
                if (data.channels && data.channels.length > 0) {
                    const ul = document.createElement('ul');
                    data.channels.forEach(channel => {
                        const li = document.createElement('li');
                        li.textContent = channel;
                        
                        // 添加删除按钮
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = '删除';
                        deleteBtn.style.marginLeft = '10px';
                        deleteBtn.onclick = function() {
                            deleteChannel(channel);
                        };
                        li.appendChild(deleteBtn);
                        
                        ul.appendChild(li);
                    });
                    channelList.appendChild(ul);
                } else {
                    channelList.innerHTML += '<p>没有可用的频道</p>';
                }
            })
            .catch(error => {
                console.error('错误:', error);
            });
        }
        
        // 删除频道
        function deleteChannel(channel) {
            if (confirm(`确定要删除频道 ${channel} 吗？`)) {
                fetch('/broadcasting/deleteChannel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ channel: channel })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`频道 ${channel} 删除成功`);
                        getChannels();
                    } else {
                        alert('删除频道失败');
                    }
                })
                .catch(error => {
                    console.error('错误:', error);
                });
            }
        }
        
        // 页面加载时获取频道列表
        window.onload = function() {
            getChannels();
        };
    </script>
</body>
</html>

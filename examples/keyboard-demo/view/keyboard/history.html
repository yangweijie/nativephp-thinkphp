<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>快捷键历史记录</title>
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>快捷键历史记录</h1>
            <div class="nav">
                <a href="/keyboard/index">主页</a>
                <a href="/keyboard/history" class="active">历史记录</a>
                <a href="/keyboard/listener">键盘监听器</a>
            </div>
        </div>
        
        <div class="content">
            <div class="card">
                <div class="card-header">
                    <h2>快捷键触发历史</h2>
                    <div class="card-actions">
                        <button class="btn btn-danger" onclick="clearHistory()">清空历史记录</button>
                    </div>
                </div>
                <div class="card-body">
                    {if empty($history)}
                    <p>暂无历史记录</p>
                    {else}
                    <table class="table">
                        <thead>
                            <tr>
                                <th>快捷键组合</th>
                                <th>描述</th>
                                <th>类型</th>
                                <th>触发时间</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="history" id="item"}
                            <tr>
                                <td>{$item.accelerator}</td>
                                <td>{$item.description}</td>
                                <td>{$item.is_global ? '全局' : '应用程序'}</td>
                                <td>{$item.triggered_at}</td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                    {/if}
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    <script>
        // 清空历史记录
        function clearHistory() {
            if (!confirm('确定要清空历史记录吗？此操作不可恢复。')) {
                return;
            }
            
            fetch('/keyboard/clearHistory', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('成功', data.message);
                    // 刷新页面
                    location.reload();
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('错误', '清空历史记录失败');
            });
        }
        
        // 显示通知
        function showNotification(title, body) {
            if (typeof window.NativePHP !== 'undefined') {
                window.NativePHP.notification.send(title, body);
            } else {
                alert(`${title}: ${body}`);
            }
        }
    </script>
</body>
</html>

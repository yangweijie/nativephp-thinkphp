<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>查看压缩文件 - {$filename}</title>
    <link rel="stylesheet" href="/static/css/app.css">
    <style>
        .archive-container {
            margin: 20px 0;
        }
        
        .archive-info {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .archive-info h2 {
            margin-top: 0;
        }
        
        .archive-info p {
            margin: 5px 0;
        }
        
        .archive-contents {
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .archive-contents table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .archive-contents th {
            background-color: #f0f0f0;
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .archive-contents td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }
        
        .archive-contents tr:last-child td {
            border-bottom: none;
        }
        
        .archive-contents tr:hover td {
            background-color: #f9f9f9;
        }
        
        .folder-icon, .file-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .folder-icon {
            background: url('/static/images/folder.png') no-repeat center center;
            background-size: contain;
        }
        
        .file-icon {
            background: url('/static/images/file.png') no-repeat center center;
            background-size: contain;
        }
        
        .extract-button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>查看压缩文件</h1>
            <div class="actions">
                <a href="/file/index?path={:urlencode(dirname($path))}" class="btn">返回文件管理器</a>
                <button onclick="extractArchive('{$path}')" class="btn btn-primary">解压文件</button>
            </div>
        </div>
        
        <div class="archive-container">
            <div class="archive-info">
                <h2>{$filename}</h2>
                <p><strong>类型:</strong> {$type}</p>
                <p><strong>路径:</strong> {$path}</p>
                <p><strong>文件数:</strong> {$contents|count}</p>
            </div>
            
            <div class="archive-contents">
                <table>
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>大小</th>
                            <th>压缩后大小</th>
                            <th>修改时间</th>
                            <th>类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        {volist name="contents" id="item"}
                        <tr>
                            <td>
                                {if $item.isDir}
                                <span class="folder-icon"></span>
                                {else}
                                <span class="file-icon"></span>
                                {/if}
                                {$item.name}
                            </td>
                            <td>{:isset($item.size) ? format_size($item.size) : '-'}</td>
                            <td>{:isset($item.compressedSize) ? format_size($item.compressedSize) : '-'}</td>
                            <td>{:isset($item.mtime) ? date('Y-m-d H:i:s', $item.mtime) : '-'}</td>
                            <td>{$item.isDir ? '文件夹' : '文件'}</td>
                        </tr>
                        {/volist}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    <script>
        // 解压文件
        function extractArchive(path) {
            fetch('/archive/extract', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'source=' + encodeURIComponent(path),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 解压成功，跳转到解压目录
                    window.location.href = '/file/index?path=' + encodeURIComponent(data.path);
                } else {
                    showNotification('错误', data.message);
                }
            })
            .catch(error => {
                showNotification('错误', error.message);
            });
        }
    </script>
</body>
</html>
